<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö SN ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        margin: 20px;
        background-color: #f8f9fa;
      }
      h1,
      h2,
      h3 {
        text-align: center;
      }
      .container {
        display: flex;
        justify-content: space-between;
        gap: 20px;
        margin-top: 20px;
      }
      .box {
        flex: 1;
        min-width: 450px;
        max-width: 48%;
        background: white;
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      .table-container {
        max-height: 400px;
        overflow: auto;
        border: 1px solid #ddd;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }
      th,
      td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }
      th {
        background: #007bff;
        color: white;
      }
      tr:nth-child(even) {
        background: #f2f2f2;
      }
      button {
        margin-top: 10px;
        padding: 5px 10px;
        cursor: pointer;
      }
    </style>
  </head>
  <body>
    <h1>‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ï‡πä‡∏≠‡∏Å‡∏ï‡∏≤‡∏°‡∏´‡∏°‡∏ß‡∏î</h1>
    <h2>‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå Excel</h2>
    <input type="file" id="uploadExcel" />
    <button onclick="clearData()">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    <h2>‡∏¢‡∏¥‡∏á SN ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
    <input
      type="text"
      id="scanSN"
      placeholder="‡∏Å‡∏£‡∏≠‡∏Å SN ‡πÅ‡∏•‡πâ‡∏ß‡∏Å‡∏î Enter"
      onkeypress="handleScan(event)"
    />

    <div class="container">
      <div class="box">
        <h3>
          üì¶ ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á (<span id="inventoryCount">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)
        </h3>
        <button onclick="clearInventoryData()">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ù‡∏±‡πà‡∏á‡∏ã‡πâ‡∏≤‡∏¢</button>
        <div class="table-container">
          <table id="inventoryTable">
            <tr>
              <th>NO</th>
              <th>Itemtype</th>
              <th>Code</th>
              <th>Product</th>
              <th>SN</th>
            </tr>
          </table>
        </div>
      </div>
      <div class="box">
        <h3>
          üìã ‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß (<span id="scannedCount">0</span> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£)
        </h3>
        <button onclick="clearScannedData()">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ù‡∏±‡πà‡∏á‡∏Ç‡∏ß‡∏≤</button>
        <div class="table-container">
          <table id="scannedTable">
            <tr>
              <th>NO</th>
              <th>Itemtype</th>
              <th>Code</th>
              <th>Product</th>
              <th>SN</th>
              <th>Action</th>
            </tr>
          </table>
        </div>
      </div>
    </div>

    <script>
      let inventory = [];
      let scannedItems = JSON.parse(localStorage.getItem("scannedItems")) || [];

      function playSound(url) {
        let audio = new Audio(url);
        audio.play();
      }

      document
        .getElementById("uploadExcel")
        .addEventListener("change", function (event) {
          let file = event.target.files[0];
          let reader = new FileReader();
          reader.onload = function (e) {
            let data = new Uint8Array(e.target.result);
            let workbook = XLSX.read(data, { type: "array" });
            let sheet = workbook.Sheets[workbook.SheetNames[0]];
            let jsonData = XLSX.utils.sheet_to_json(sheet, { header: 1 });

            let headers = jsonData[1];
            let dataRows = jsonData.slice(2);

            let existingSNs = new Set(inventory.map((item) => item.sn));
            let newItems = dataRows
              .map((row, index) => {
                let sn = (row[headers.indexOf("Sn")] || "").toString().trim();
                if (existingSNs.has(sn)) return null;
                return {
                  no: inventory.length + index + 1,
                  itemtype: row[headers.indexOf("Itemtype")] || "-",
                  code: row[headers.indexOf("Code")] || "-",
                  product: row[headers.indexOf("Product")] || "-",
                  sn: sn,
                };
              })
              .filter((item) => item !== null);

            inventory = inventory.concat(newItems);
            updateTables();
            document.getElementById("uploadExcel").value = "";
          };
          reader.readAsArrayBuffer(file);
        });

      function handleScan(event) {
        if (event.key === "Enter") {
          let sn = event.target.value.trim();
          let foundItem = inventory.find((item) => item.sn === sn);
          let isScanned = scannedItems.some((item) => item.sn === sn);

          if (isScanned) {
            Swal.fire("‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô!", `SN ${sn} ‡∏ñ‡∏π‡∏Å‡∏¢‡∏¥‡∏á‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß!`, "warning");
            playSound(
              "https://branch.advice.co.th/52000036/themes/home/audio/Ctmelody.mp3"
            );
          } else if (!foundItem) {
            Swal.fire("‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î!", `‡πÑ‡∏°‡πà‡∏û‡∏ö SN ${sn} ‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á!`, "error");
            playSound(
              "https://branch.advice.co.th/52000036/themes/home/audio/oh_no.mp3"
            );
          } else {
            scannedItems.push(foundItem);
            inventory = inventory.filter((item) => item.sn !== sn);

            // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ç‡∏≠‡∏á SN ‡∏ô‡∏µ‡πâ‡∏´‡∏°‡∏î‡∏à‡∏≤‡∏Å‡∏Ñ‡∏•‡∏±‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á
            let remainingItems = inventory.filter(
              (item) => item.code === foundItem.code
            );
            if (remainingItems.length === 0) {
              playSound(
                "https://branch.advice.co.th/52000036/themes/home/audio/yahoo.mp3"
              );
            } else {
              playSound(
                "https://branch.advice.co.th/52000036/themes/home/audio/DING.mp3"
              );
            }

            updateTables();
          }
          event.target.value = "";
        }
      }

      function updateTables() {
        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏´‡πâ inventory
        inventory.forEach((item, index) => {
          item.no = index + 1;
        });

        let inventoryTable = document.getElementById("inventoryTable");
        inventoryTable.innerHTML = `<tr><th>NO</th><th>Itemtype</th><th>Code</th><th>Product</th><th>SN</th></tr>`;
        inventory.forEach((item) => {
          let row = inventoryTable.insertRow();
          row.insertCell(0).textContent = item.no;
          row.insertCell(1).textContent = item.itemtype;
          row.insertCell(2).textContent = item.code;
          row.insertCell(3).textContent = item.product;
          row.insertCell(4).textContent = item.sn;
        });

        let scannedTable = document.getElementById("scannedTable");
        scannedTable.innerHTML = `<tr><th>NO</th><th>Itemtype</th><th>Code</th><th>Product</th><th>SN</th><th>Action</th></tr>`;
        scannedItems.forEach((item, index) => {
          let row = scannedTable.insertRow();
          row.insertCell(0).textContent = index + 1;
          row.insertCell(1).textContent = item.itemtype;
          row.insertCell(2).textContent = item.code;
          row.insertCell(3).textContent = item.product;
          row.insertCell(4).textContent = item.sn;
          let actionCell = row.insertCell(5);
          let deleteBtn = document.createElement("button");
          deleteBtn.textContent = "‡∏•‡∏ö";
          deleteBtn.onclick = () => removeScannedItem(index);
          actionCell.appendChild(deleteBtn);
        });

        document.getElementById("inventoryCount").textContent =
          inventory.length;
        document.getElementById("scannedCount").textContent =
          scannedItems.length;
        localStorage.setItem("scannedItems", JSON.stringify(scannedItems));
      }

      function removeScannedItem(index) {
        Swal.fire({
          title: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?",
          text: "‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö SN ‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡∏∞‡∏¢‡πâ‡∏≤‡∏¢‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏Ñ‡∏•‡∏±‡∏á‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#d33",
          cancelButtonColor: "#3085d6",
          confirmButtonText: "‡πÉ‡∏ä‡πà, ‡∏•‡∏ö‡πÄ‡∏•‡∏¢!",
          cancelButtonText: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å",
        }).then((result) => {
          if (result.isConfirmed) {
            let removedItem = scannedItems.splice(index, 1)[0]; // ‡∏ô‡∏≥‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏•‡∏ö‡∏≠‡∏≠‡∏Å
            inventory.push(removedItem); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÉ‡∏ô‡∏Ñ‡∏•‡∏±‡∏á
            updateTables();
            localStorage.setItem("scannedItems", JSON.stringify(scannedItems));
            Swal.fire("‡∏•‡∏ö‡πÅ‡∏•‡πâ‡∏ß!", "SN ‡πÑ‡∏î‡πâ‡∏ñ‡∏π‡∏Å‡∏¢‡πâ‡∏≤‡∏¢‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏¢‡∏±‡∏á‡∏Ñ‡∏•‡∏±‡∏á.", "success");
          }
        });
      }

      function clearScannedData() {
        Swal.fire({
          title: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•?",
          text: "‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#d33",
          cancelButtonColor: "#3085d6",
          confirmButtonText: "‡πÉ‡∏ä‡πà, ‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏¢!",
          cancelButtonText: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å",
        }).then((result) => {
          if (result.isConfirmed) {
            scannedItems = []; // ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß
            updateTables(); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á
            localStorage.removeItem("scannedItems"); // ‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å localStorage
            Swal.fire(
              "‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß!",
              "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏ñ‡∏π‡∏Å‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î.",
              "success"
            );
          }
        });
      }

      function clearInventoryData() {
        Swal.fire({
          title: "‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•?",
          text: "‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#d33",
          cancelButtonColor: "#3085d6",
          confirmButtonText: "‡πÉ‡∏ä‡πà, ‡∏•‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏¢!",
          cancelButtonText: "‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å",
        }).then((result) => {
          if (result.isConfirmed) {
            inventory = []; // ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ù‡∏±‡πà‡∏á‡∏Ñ‡∏•‡∏±‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
            updateTables(); // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á
            Swal.fire(
              "‡∏•‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß!",
              "‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏Ñ‡∏•‡∏±‡∏á‡∏ñ‡∏π‡∏Å‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î.",
              "success"
            );
          }
        });
      }
    </script>
  </body>
</html>
